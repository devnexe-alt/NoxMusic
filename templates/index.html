{% extends "base.html" %}

{% block content %}
<header class="hero">
  <div id="hero-inner">
    <h1>Good evening</h1>
  </div>
</header>

<section class="content">
  <div class="content-header">
    <h2 id="content-title">Made for you</h2>
    <input type="text" id="search-input" placeholder="What do you want to listen to?" />
  </div>

  <div class="grid">
    {% for p in playlists[:6] %}
    <div class="tile" onclick="loadPlaylist({{ p.id }})" style="cursor:pointer">
      <div class="cover" style="background:{{ p.gradient }}">{{ p.cover }}</div>
      <div>
        <div style="font-weight:700">{{ p.name }}</div>
        <div class="meta">{{ p.trackCount }} songs</div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="tracks">
    <div class="tracks-head">
      <div>#</div>
      <div>TITLE</div>
      <div>ALBUM</div>
      <div></div>
      <div></div>
      <div>‚è±</div>
    </div>
    {% for t in tracks %}
    <div class="track-row" data-id="{{ t.id }}">
      <div class="track-index">{{ loop.index }}</div>
      <div style="display:flex;gap:10px;align-items:center">
        <div class="track-cover" style="background:{{ t.gradient }};cursor:pointer" onclick="playTrack({{ t.id }})">{{ t.cover }}</div>
        <div>
          <div class="track-title" style="cursor:pointer" onclick="playTrack({{ t.id }})">{{ t.title }}</div>
          <div class="track-artist">{{ t.artist }}</div>
        </div>
      </div>
      <div class="meta">{{ t.album }}</div>
      <div class="track-actions">
        <button class="like-btn" onclick="toggleLike({{ t.id }})">ü§ç</button>
        <button class="queue-add" onclick="addToQueue({{ t.id }})">+</button>
      </div>
      <div style="text-align:right">
        {% if t.duration %}
          {{ (t.duration // 60) }}:{% if (t.duration % 60) < 10 %}0{% endif %}{{ t.duration % 60 }}
        {% else %}
          0:00
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–∫–∞–º–∏
function playTrack(trackId) {
  fetch(`/api/tracks/${trackId}/play`, { method: 'POST' })
    .then(() => {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
      console.log(`Playing track ${trackId}`);
    });
}

async function toggleLike(trackId) {
  const res = await fetch(`/api/tracks/${trackId}/like`, { method: 'POST' });
  if (res.ok) {
    const data = await res.json();
    const btn = document.querySelector(`button[onclick="toggleLike(${trackId})"]`);
    if (btn) {
      btn.textContent = data.liked ? 'üíö' : 'ü§ç';
    }
  }
}

function addToQueue(trackId) {
  console.log(`Added track ${trackId} to queue`);
  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ—á–µ—Ä–µ–¥–∏
}

function loadPlaylist(playlistId) {
  window.location.href = `/playlist/${playlistId}`;
}
</script>
{% endblock %}